[
  {
    "objectID": "blog.html",
    "href": "blog.html",
    "title": "Blog",
    "section": "",
    "text": "A River’s History Visualized\n\n\n\n\n\n\nVisualization\n\n\nDEM\n\n\nXarray\n\n\nGeoPandas\n\n\nPython\n\n\n\nVisualizing the meanderings of the Snake River in Grand Teton National Park using a relative elevation model\n\n\n\n\n\nNov 3, 2024\n\n\nColin Hill\n\n\n2 min\n\n\n\n\n\n\n\n\n\n\n\n\nWelcome\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\nOct 2, 2024\n\n\nColin Hill\n\n\n1 min\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome",
    "section": "",
    "text": "Welcome my blog. This will be a space to jot down ideas, experiments, and things I find interesting. I love having a nice visualization to go along with code and analysis, so to kick off I’ll just include this incredible image of the Yukon Delta in Alaska.\n\n\n\nFalse-color image of the Yukon Delta, Alaska, USA (source)\n\n\n\nTopics\nSome major themes will be:\n\nRemote sensing\nEnvironment\nClimate\nWeather\nDemographics\nGeospatial data\n\nAs well as software and tools such as:\n\nPython\nJulia\nMachine Learning / Artificial intelligence\nCloud native data\nGeospatial software\n\n\n\nTech stack\nI’m building this website with Quarto and Pixi."
  },
  {
    "objectID": "posts/relative_elevation_model/index.html",
    "href": "posts/relative_elevation_model/index.html",
    "title": "A River’s History Visualized",
    "section": "",
    "text": "A wonderful aspect of geospatial data is that it’s both beautiful and informative. In this post I look at the migration of the Snake River in Grand Teton National Park, USA over time by creating a relative elevation model (REM). This takes a digital elevation model (DEM) and de-trends the baseline elevation so it follows the water’s surface. By doing so, we can clearly see the migration of the river’s channels and the associated features such as oxbow lakes, meander scars and terraces.\nThis post was inspired by this blog post and this notebook, and makes use of the HyRiver suite of package for data access: PyNHD for river flowlines and Py3DEP for a high resolution DEM.\n\n# Define AOI bounding box\n\n# Snake River, Grand Teton National Park\nbbox = [-110.583466, 43.790715, -110.509222, 43.848585] # WSG84 coordinates, WSEN\n\nFor the first step we will retrieve the river’s path. We can retrieve the river’s flowline (geometry) from USGS data which is easily accessible using the PyNHD package\n\n\nCode\nimport pynhd\nimport py3dep\nimport geopandas as gpd\nimport shapely\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nimport pyproj\nimport numpy as np\nimport pygeoutils\nimport xarray as xr\nfrom scipy.spatial import KDTree\n%config InlineBackend.figure_formats = ['png']\n\n\n\n# Connect to service \nwater_data = pynhd.WaterData(\"nhdflowline_network\")\n\n# Get flowlines within bounding box\nflowlines = water_data.bybox(bbox)\n\n\n# This returns a GeoDataFrame\nflowlines.head(2)\n\n\n\n\n\n\n\n\ngeometry\ncomid\nfdate\nresolution\ngnis_id\ngnis_name\nlengthkm\nreachcode\nflowdir\nwbareacomi\n...\nqc_12\nvc_12\nqe_12\nve_12\nlakefract\nsurfarea\nrareahload\nrpuid\nvpuid\nenabled\n\n\n\n\n0\nMULTILINESTRING Z ((-110.54139 43.79185 0, -11...\n23123173\n2005-07-21T04:00:00Z\nMedium\n\n\n3.651\n17040101000094\nWith Digitized\n0\n...\n0.132\n0.53390\n0.132\n0.53390\nNaN\nNaN\nNaN\n17a\n17\n1\n\n\n1\nMULTILINESTRING Z ((-110.54022 43.79151 0, -11...\n23123175\n2001-02-07T05:00:00Z\nMedium\n1603229\nSpread Creek\n0.102\n17040101000095\nWith Digitized\n0\n...\n68.385\n1.23836\n68.385\n1.23836\nNaN\nNaN\nNaN\n17a\n17\n1\n\n\n\n\n2 rows × 138 columns\n\n\n\nWe want to keep the main stream only, which in this case we can easily do by filtering on the gnis_name\n\nflowline = flowlines.loc[flowlines['gnis_name'].eq('Snake River')]\n\n\n# Plot flowlines and bounding box\n\n# Create GeoDataframe with bounding box\ngdf_bbox = gpd.GeoDataFrame(data={'geometry': shapely.box(*bbox)}, index=[0], crs='EPSG:4326')\nm = flowlines.explore(color='blue')\nflowline.explore(color='red', m=m)\ngdf_bbox.explore(color=\"black\", style_kwds={\"fillColor\": \"None\"}, m=m)\nm\n\nMake this Notebook Trusted to load map: File -&gt; Trust Notebook\n\n\nFor the next step, we’ll retrieve a DEM for the region. For this we can use the Py3DEP package which gives us easy access to the USDA 3DEP database\n\n# Check which resolutions are available in our AOI\ndem_resolutions = py3dep.check_3dep_availability(bbox)\ndem_resolutions\n\n{'1m': True,\n '3m': True,\n '5m': False,\n '10m': True,\n '30m': True,\n '60m': False,\n 'topobathy': False}\n\n\nDEM data is available at up to 1m resolution, however we’ll use 3m to save time and computation. We can simply use py3dep.get_dem to download data for our AOI and chosen resolution and return an xarray.DataArray\n\ndem = py3dep.get_dem(bbox, resolution=3, crs=flowline.crs)\n\n\n# Plot DEM with river overlayed\nfig, ax = plt.subplots(figsize=(6, 4))\ndem.plot(ax=ax, robust=True);\nflowline.plot(ax=ax, color=\"r\");\n\n\n\n\n\n\n\n\nTo de-trend the DEM, we need to find the elevation profile along the river’s flowline. While py3dep.elevation_profile provides this functionality, it uses the 10m DEM, and as we already have 3m data we can use it instead with a little extra work.\n\n# First combine all geometries to a single MultiLineString\nline = shapely.union_all(flowline.line_merge())\n\n# Smooth the line to 3m spacing and extract height from the DEM\n\n# Reproject to meters\nproject = pyproj.Transformer.from_crs(flowline.crs, 5070, always_xy=True).transform\nline_5070 = shapely.ops.transform(project, line)\n\n# Smooth line\nspacing = 3 # 3m spacing\nnpts = int(np.ceil(line_5070.length / spacing))\nline_5070_smooth = pygeoutils.smooth_linestring(line_5070, 0.1, npts)\n\n# Reproject back to original crs\nproject = pyproj.Transformer.from_crs(5070, flowline.crs, always_xy=True).transform\nline_smooth = shapely.ops.transform(project, line_5070_smooth)\n\n# Extract elevation from DEM\nxs, ys = line_smooth.xy\nxs, ys = xr.DataArray(xs, dims='distance'), xr.DataArray(ys, dims='distance')\nriver_dem = dem.interp(x=xs, y=ys, method='nearest').dropna(dim='distance')\n\nTo mitigate artifacts arising from the river geometry and DEM not matching (due to natural change over time), we can ensure that the river elevation decreases or stays constant between pixels\n\n# Ensure the elevation is non-increasing\nriver_dem.values = np.minimum.accumulate(river_dem.values)\n\n\nriver_dem.plot(figsize=(4, 2));\n\n\n\n\n\n\n\n\nNow we need to interpolate the height of the river over the entire AOI. We can do this using the inverse distance weighting (IDW) method.\n\n\nCode\ndef idw(da_in: xr.DataArray, da_out: xr.DataArray, k: int = 10, n: float = 1) -&gt; xr.DataArray:\n    \"\"\"\n    Inverse distance weighted interpolation\n    \n    Args:\n        da_in: Input data to interpolate\n        da_out: Output grid\n        k: Number of nearest points to include\n        n: Exponent of the weighting\n\n    Returns:\n        Interpolated data\n    \"\"\"\n    coords = np.column_stack((da_in.x, da_in.y))\n    kdt = KDTree(coords)\n\n    grid = np.dstack(np.meshgrid(da_out.x, da_out.y)).reshape(-1, 2)\n    distances, indices = kdt.query(grid, k=k)\n\n    weights = np.power(np.reciprocal(distances), n)\n    weights = weights / weights.sum(axis=1, keepdims=True)\n    interp = weights * da_in.to_numpy()[indices]\n    interp = interp.sum(axis=1).reshape((da_out.sizes[\"y\"], da_out.sizes[\"x\"]))\n    interp = xr.DataArray(interp, dims=(\"y\", \"x\"), coords={\"x\": da_out.x, \"y\": da_out.y})\n    return interp\n\n\n\nriver_dem_interp = idw(river_dem, dem, k=200, n=0.5)\n\n\nriver_dem_interp.plot(figsize=(6, 4));\n\n\n\n\n\n\n\n\nFinally, we can compute the REM from the river’s elevation profile and the DEM\n\nrem = dem - river_dem_interp\n\n\n# To simplify plotting, set minimum to zero\nrem = rem - rem.min()\n\n\nax = rem.plot.imshow(figsize=(12,8), cmap=\"YlGnBu\", norm=mpl.colors.LogNorm(vmin=1, vmax=10), add_colorbar=False, add_labels=False);\nax.axes.set_aspect('equal');\nax.axes.axis('off');\n\n\n\n\n\n\n\n\nWe can clearly see the complex pattern of different paths the river has taken over the years, and the extent of the floodplains."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Dr. Colin Hill",
    "section": "",
    "text": "I’m a data scientist and physicist working at the intersection of remote sensing, climate, environment and machine learning.\nI’ve worked across diverse domains ranging from stellar astrophysics to weather forecasts, from climate data to crops, GHG emissions and soil carbon sequestration. I enjoy working on challenging and impactful problems, and a consistent focus has been creating data-driven insights from sensors using physical principles combined with statistical and machine learning approaches."
  },
  {
    "objectID": "index.html#bio",
    "href": "index.html#bio",
    "title": "Dr. Colin Hill",
    "section": "",
    "text": "I’m a data scientist and physicist working at the intersection of remote sensing, climate, environment and machine learning.\nI’ve worked across diverse domains ranging from stellar astrophysics to weather forecasts, from climate data to crops, GHG emissions and soil carbon sequestration. I enjoy working on challenging and impactful problems, and a consistent focus has been creating data-driven insights from sensors using physical principles combined with statistical and machine learning approaches."
  },
  {
    "objectID": "index.html#experience",
    "href": "index.html#experience",
    "title": "Dr. Colin Hill",
    "section": "Experience",
    "text": "Experience\nRegrow Ag | 2022-2024\nSenior Data Scientist\nTechnical Lead\nWeatherForce | 2019-2021\nSenior Data Scientist\nInstitut de Recherche en Astrophysique et Planétologie | 2016-2019\nPostdoctoral Research Scientist (Astrophysics)"
  },
  {
    "objectID": "index.html#education",
    "href": "index.html#education",
    "title": "Dr. Colin Hill",
    "section": "Education",
    "text": "Education\nPh.D. Astrophysics | 2012-2015\nQueen’s University Belfast, UK\nM.Sci. Physics | 2008-2012\nQueen’s University Belfast, UK"
  }
]